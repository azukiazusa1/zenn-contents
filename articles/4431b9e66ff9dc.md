---
title: "ã€mongooseã€‘Cannot overwrite 'Model' model once compiled. ã‚¨ãƒ©ãƒ¼ã®ç›´ã—æ–¹"
emoji: "ğŸ¦”"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: []
published: true
---

[mongoose](https://mongoosejs.com/docs/guide.html)ã§ãƒ¢ãƒ‡ãƒ«ã‚’å®šç¾©ã—ãŸã‚ã¨ã€ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ãªã©ã‚’ã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ã«é­é‡ã—ã¾ã™ã€‚

```
Cannot overwrite 'Model' model once compiled. 
```

ãƒ¢ãƒ‡ãƒ«ã¯æ¬¡ã®ã‚ˆã†ã«å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

```ts
import mongoose, { Schema, Document, Model } from 'mongoose'

export interface UserDoc extends Document, {
  username: string
  email: string
  password: string
}

const userSchema: Schema = new Schema(
  {
    username: {
      type: String,
      required: true
    },
    email: {
      type: String,
      required: true
    },
    password: {
      type: String,
      required: true
    },
  }
)

interface UserModel extends Model<UserDoc> {}

export default mongoose.model<UserDoc, UserModel>('User', userSchema)
```
`mongoose`ã§ã¯ã€åŒã˜ã‚¹ã‚­ãƒ¼ãƒã‚’ä½¿ç”¨ã—ã¦`mongoose.model()`ã§2åº¦ä»¥ä¸Šã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚

æ¬¡ã®ã‚ˆã†ã«ä¿®æ­£ã™ã‚‹ã“ã¨ã§ã‚¨ãƒ©ãƒ¼ã‚’è§£æ¶ˆã§ãã¾ã™ã€‚

```diff
- import mongoose, { Schema, Document, Model } from 'mongoose'
+ import mongoose, { Schema, Document, Model, models } from 'mongoose'

export interface UserDoc extends Document, {
  username: string
  email: string
  password: string
}

const userSchema: Schema = new Schema(
  {
    username: {
      type: String,
      required: true
    },
    email: {
      type: String,
      required: true
    },
    password: {
      type: String,
      required: true
    },
  }
)

interface UserModel extends Model<UserDoc> {}

- export default mongoose.model<UserDoc, UserModel>('User', userSchema)
+ export default models.User
+   ? (models.User as UserModel)
+   : mongoose.model<UserDoc, UserModel>('User', userSchema)
```

`mongoose`ã‚‚`models`ã¯ã€ã™ã§ã«ç™»éŒ²æ¸ˆã®ãƒ¢ãƒ‡ãƒ«åã‚’ã‚­ãƒ¼ã¨ã—ã¦å–å¾—ã§ãã¾ã™ã€‚

`models`ã«ã™ã§ã«å­˜åœ¨ã™ã‚‹ã«ã¯ã€ãã‚Œã‚’`export`ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ã€åŒã˜ãƒ¢ãƒ‡ãƒ«ã‚’å†ç™»éŒ²ã™ã‚‹ã“ã¨ã«ã‚ˆã‚‹ç”Ÿã˜ã‚‹ã‚¨ãƒ©ãƒ¼ã‚’è§£æ¶ˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

TypeScriptã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã€`models`ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒ¢ãƒ‡ãƒ«ã¯`statics`ãªã©ã‚’ãƒ¢ãƒ‡ãƒ«ã«è¿½åŠ ã—ã¦ã„ã‚‹å ´åˆæ­£ã—ã„å‹ãŒå¾—ã‚‰ã‚Œãªã„ã®ã§å‹ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã§ã—ã‚‡ã†ã€‚

`models`ã«ç™»éŒ²ã•ã‚Œã¦ã„ãªã‹ã£ãŸå ´åˆã€é€šå¸¸é€šã‚Šãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã—ã¦`export`ã—ã¾ã™ã€‚