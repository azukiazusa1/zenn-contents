---
title: "Reactã®ErrorBoundaryã§å†…éƒ¨ã®ã‚¨ãƒ©ãƒ¼ã‚’ã‚­ãƒ£ãƒƒãƒã™ã‚‹"
emoji: "ğŸ§"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["react", "javascript"]
published: true
---

Error Boundary ã¨ã¯ã€è‡ªèº«ã®å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ„ãƒªãƒ¼ã§ç™ºç”Ÿã—ãŸ JavaScript ã®ã‚¨ãƒ©ãƒ¼ã‚’ã‚­ãƒ£ãƒƒãƒãƒ»è¨˜éŒ²ã—ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã® UI ã‚’è¡¨ç¤ºã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã™ã€‚

ä¾‹ãˆã‚‹ãªã‚‰ã€`try/catch` æ§‹æ–‡ã‚’è¡Œã†ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚ˆã†ãªã‚‚ã®ã¨è¨€ãˆã¾ã™ã€‚

:::message
ErrorBoundary ã¯æ¬¡ã®ã‚¨ãƒ©ãƒ¼ã‚’ã‚­ãƒ£ãƒƒãƒã§ããªã„ã“ã¨ã«ä¸­æ­¢ã—ã¦ãã ã•ã„ã€‚
:::

- ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©
- éåŒæœŸã‚³ãƒ¼ãƒ‰ï¼ˆä¾‹ï¼šsetTimeout ã‚„ requestAnimationFrame ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
- ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
-ï¼ˆå­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã¯ãªãï¼‰error boundary è‡ªèº«ãŒã‚¹ãƒ­ãƒ¼ã—ãŸã‚¨ãƒ©ãƒ¼

# ã‚¨ãƒ©ãƒ¼ãŒã‚­ãƒ£ãƒƒãƒã•ã‚Œãªã„å ´åˆã®å‹•ä½œ

ErrorBoundary ã®è©³ç´°ã‚’è¦‹ã‚‹å‰ã«ã€ã‚¨ãƒ©ãƒ¼ãŒã‚­ãƒ£ãƒƒãƒã•ã‚Œãªã„å ´åˆã®å‹•ä½œã‚’ç¢ºèªã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚

React16 ã‹ã‚‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ„ãƒªãƒ¼å…¨ä½“ãŒã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã•ã‚Œã¾ã™ã€‚

ä¸‹è¨˜ã®ç°¡å˜ãªã‚³ãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚

```js:App.js
const Red = () => {
  return (
    <div style={{backgroundColor: "red", flex: 1, height: 100 }}>Red Area</div>
  )
}

const Green = () => {
  return (
    <div style={{backgroundColor: "green", flex: 1 ,height: 100 }}>Green Area</div>
  )
}
const Blue = () => {
  return (
    <div style={{backgroundColor: "blue", flex: 1 ,height: 100}}>Blue Area</div>
  )
}

function App() {
  return (
    <div style={{ display: "flex" }}>
      <Red />
      <Green />
      <Blue />
    </div>
  )
}

export default App;
```

![](https://storage.googleapis.com/zenn-user-upload/c072208b5f8687e0008498cd.png)

Red ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§æ£æ„çš„ã«ã‚¨ãƒ©ãƒ¼ã‚’ç™ºç”Ÿã•ã›ã¾ã™ã€‚

```js:App.js
const BadComponent = () => { throw new Error("something went wrong") }

const Red = () => {
  return (
    <div style={{backgroundColor: "red", flex: 1, height: 100 }}>
      Red Area
      <BadComponent />
    </div>
  )
}
```

ç”»é¢ãŒçœŸã£ç™½ã«ãªã£ã¦ã—ã¾ã„ã¾ã—ãŸã€‚

![](https://storage.googleapis.com/zenn-user-upload/1b60f680dd57f3adaf479aed.png)

# Error Boundaryã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ

çœŸã£ç™½ãªç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¦ã—ã¾ã†ã®ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¨ã£ã¦ã‚ã¾ã‚Šã«ã‚‚ä¸ä¾¿ã§ã™ã®ã§ã€Error Boundary ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¦ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸéš›ã® UI ã‚’ç”¨æ„ã—ã¾ã—ã‚‡ã†ã€‚

ä»¥ä¸‹ã„ãšã‚Œã‹ã®ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã—ãŸã‚¯ãƒ©ã‚¹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ Error Boundary ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦æ‰±ã‚ã‚Œã¾ã™ã€‚

- [static getDerivedStateFromError()](https://ja.reactjs.org/docs/react-component.html#static-getderivedstatefromerror)
- [componentDidCatch()]()

[å…¬å¼](https://ja.reactjs.org/docs/error-boundaries.html)ã® Error Boundary ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä¾‹ã‚’ãã®ã¾ã¾æ²è¼‰ã—ã¾ã™ã€‚

```js:App.js
export default class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error) {
    // Update state so the next render will show the fallback UI.
    return { hasError: true };
  }

  componentDidCatch(error, errorInfo) {
    // You can also log the error to an error reporting service
    logErrorToMyService(error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      // You can render any custom fallback UI
      return <h1>Something went wrong.</h1>;
    }

    return this.props.children; 
  }
}
```

### static getDerivedStateFromError

ã“ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ UI ã‚’æç”»ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

`getDerivedStateFromError()` ã¯å­å­«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã‚ˆã£ã¦ã‚¨ãƒ©ãƒ¼ãŒã‚¹ãƒ­ãƒ¼ã•ã‚ŒãŸéš›ã«å‘¼ã³å‡ºã•ã‚Œã¾ã™ã€‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã¨ã—ã¦ã‚¹ãƒ­ãƒ¼ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼å—ã‘å–ã‚Šã€state ã‚’æ›´æ–°ã™ã‚‹ãŸã‚ã®å€¤ã‚’è¿”ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### componentDidCatch

ã“ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã¯ä¸»ã«ãƒ­ã‚®ãƒ³ã‚°ãªã©ã®å‡¦ç†ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

`componentDidCatch` ã¯åŒã˜ãå­å­«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã‚ˆã£ã¦ã‚¨ãƒ©ãƒ¼ãŒã‚¹ãƒ­ãƒ¼ã•ã‚ŒãŸéš›ã«å‘¼ã³å‡ºã•ã‚Œã¾ã™ã€‚
ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã¨ã—ã¦ã‚¹ãƒ­ãƒ¼ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ã¨ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹æƒ…å ±ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚

### render

`render` ãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯ã€`getDerivedStateFromError` ã«ã‚ˆã£ã¦ã‚¨ãƒ©ãƒ¼ã‚’ã‚­ãƒ£ãƒƒãƒã—ãŸçŠ¶æ…‹ã§ã‚ã‚‹ãªã‚‰ã°ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ UI ã‚’æç”»ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ãã‚Œä»¥å¤–ã®å ´åˆã«ã¯ã€å­è¦ç´ ã‚’ãã®ã¾ã¾æç”»ã—ã¾ã™ã€‚

# Error Boundaryã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®é…ç½®

## ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã«é…ç½®

ä½œæˆã—ãŸ Error Boundary ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’é…ç½®ã—ã¾ã™ã€‚
ã¾ãšã¯ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã«é…ç½®ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ãã®å ´åˆã«ã¯ã€ã™ã¹ã¦ã®å­å­«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚¨ãƒ©ãƒ¼ã‚’ã‚­ãƒ£ãƒƒãƒã—ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã® UI ãŒæç”»ã•ã‚Œã¾ã™ã€‚

`index.js` ã‚’ç·¨é›†ã—ã¾ã™ã€‚

```js:index.js
import React from 'react';
import ReactDOM from 'react-dom';
import './index.css';
import App from './App';
import reportWebVitals from './reportWebVitals';
import ErrorBoundary from './components/ErrorBoundary'

ReactDOM.render(
  <ErrorBoundary>
    <App />
  </ErrorBoundary>,
  document.getElementById('root')
);
```

![](https://storage.googleapis.com/zenn-user-upload/139ba7a489a859ae9ab7c5d9.png)

## å€‹åˆ¥ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«é…ç½®

Error Boundary ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã€å€‹åˆ¥ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãšã¤ãƒ©ãƒƒãƒ—ã—ã¦é…ç½®ã§ãã¾ã™ã€‚
ãã®å ´åˆã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä»¥å¤–ã®ç®‡æ‰€ã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã® UI ã‚’è¡¨ç¤ºã›ãšã«ãã®ã¾ã¾ã®çŠ¶æ…‹ã‚’ç¶­æŒã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

```js:App.js
const Red = () => {
  return (
    <ErrorBoundary>
      <div style={{backgroundColor: "red", flex: 1, height: 100 }}>
        Red Area
        <BadComponent />
      </div>
    </ErrorBoundary>
  )
}

const Green = () => {
  return (
    <ErrorBoundary>
      <div style={{backgroundColor: "green", flex: 1 ,height: 100 }}>Green Area</div>
    </ErrorBoundary>
  )
}
const Blue = () => {
  return (
    <ErrorBoundary>
      <div style={{backgroundColor: "blue", flex: 1 ,height: 100}}>Blue Area</div>
    </ErrorBoundary>
  )
}
```

ä»Šåº¦ã¯ Red ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã¿ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ UI ãŒæç”»ã•ã‚Œã¾ã—ãŸã€‚

![](https://storage.googleapis.com/zenn-user-upload/40306cc62d46201557d388a2.png)