---
title: "Storybook ã§ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã‚’ä½œæˆã—ã¦ Jest ã§å†åˆ©ç”¨ã™ã‚‹"
emoji: "ğŸ’¬"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["storybook", "jest", "vue"]
published: true
---

Storybook ã® [Component Story Format 3.0](https://storybook.js.org/blog/component-story-format-3-0/) ã§ã¯æ–°æ©Ÿèƒ½ã¨ã—ã¦ `play()` é–¢æ•°ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚

`play()` é–¢æ•°ã¯ Storybook ä¸Šã§ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¯ãƒªãƒƒã‚¯ã‚„ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›ã®ã‚ˆã†ãªã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ãªæ“ä½œã‚’è¡¨ç¾ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

`play()` é–¢æ•°ã®å¤§ããªç‰¹å¾´ã¨ã—ã¦ã¯ [Component Story Format](https://storybook.js.org/blog/component-story-format/) ã®ç§»æ¤æ€§ã®é«˜ã•ã‚’åˆ©ç”¨ã—ã¦ Storybook ä¸Šã§å®šç¾©ã—ãŸã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã‚’ `Jest` ãªã©ä»–ã®é ˜åŸŸã«ãŠã„ã¦ã‚‚å†åˆ©ç”¨ã§ãã‚‹ã“ã¨ã§ã™ã€‚

ã“ã®è¨˜äº‹ã§ã¯ Vite ã« Storybook ã‚’å°å…¥ã—ã¦ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã‚’ä½œæˆã—ã¦ Jest ã§å†åˆ©ç”¨ã™ã‚‹ã¾ã§ã®æ‰‹é †ã‚’ã‚„ã£ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

## Vite ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

ã¾ãšã¯ä»¥ä¸‹ã‚³ãƒãƒ³ãƒ‰ã§ Vite ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

```sh
npm init vite@latest my-vue-app -- --template vue-ts
cd my-vue-app
npm install
```

## Storybook ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ç¶šã„ã¦ä»¥ä¸‹ã‚³ãƒãƒ³ãƒ‰ã§ Storybook ã®é››å½¢ã‚’ä½œæˆã—ã¾ã™ã€‚
ãªãŠã€CSF3.0 ã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯ Storybook version ãŒ 6.4.0 ä»¥é™ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```sh
npx sb init
```

Storybook å†…ã§ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ä»¥ä¸‹ã®ã‚¢ãƒ‰ã‚ªãƒ³ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```sh
npm i -D @storybook/addon-interactions @storybook/jest @storybook/testing-library
```

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå®Œäº†ã—ãŸã‚‰ `.storybook/main.js` ã«ã‚¢ãƒ‰ã‚ªãƒ³ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```js:.storybook/main.js
module.exports = {
  addons: ['@storybook/addon-interactions'],
};
```

## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ

æº–å‚™ãŒæ•´ã„ã¾ã—ãŸã®ã§ Storybook ã§æç”»ã™ã‚‹å¯¾è±¡ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç°¡å˜ã«ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚ä½œæˆã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ä»¥ä¸‹ã®ä»•æ§˜ã‚’æŒã¤ã“ã¨ã¨ã—ã¾ã™ã€‚

- æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’ input è¦ç´ ã®å…¥åŠ›ã§ãã‚‹
- ã€Œè¿½åŠ ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ input è¦ç´ ã®å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢ã—ã¦æ–°ãŸã«ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆã‚’è¡¨ç¤ºã™ã‚‹

ã¾ãšã¯å¿…è¦æœ€ä½é™ã®å®Ÿè£…ã®ã¿ã‚’è¡Œã„ Storybook ä¸Šã§æç”»ã‚’ç¢ºèªã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```vue:components/TaskList.vue
<template>
  <form @submit.prevent>
    <div class="form-group">
      <label for="task-name">ã‚¿ã‚¹ã‚¯å</label>
      <input type="text" id="task-name" />
      <button type="submit">è¿½åŠ </button>
    </div>
  </form>
</template>
```

## Story ã®ä½œæˆ

ãã‚Œã§ã¯ä½œæˆã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã® Story ã‚’ä½œæˆã—ã¦æç”»ã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```ts:src/components/TaskList.stories.ts
import type { Story, Meta } from '@storybook/vue3'
import TaskList from "./TaskList.vue";

export default {
  title: "TaskList",
  component: TaskList,
  argTypes: {}
} as Meta;

const Template: Story = (args) => ({
  components: { TaskList },
  setup() {
    return { args }
  },
  template: "<TaskList />",
});

export const Default = Template.bind({});
Default.args = {}
```

ä»¥ä¸‹ã‚³ãƒãƒ³ãƒ‰ã§ Storybook ã‚’èµ·å‹•ã—ã¾ã™ã€‚

```sh
npm run storybook
```

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2022-01-22 23.41.23](//images.ctfassets.net/in6v9lxmm5c8/32OGPYfkUkbSVxATbOgHVN/29daf39cfe5724ae8bb06cc22d8521b2/____________________________2022-01-22_23.41.23.png)

## ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã™ã‚‹

ãã‚Œã§ã¯æœ¬é¡Œã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚æ–°ãŸã« `InputFilled` ã¨ã„ã†Story ã‚’è¿½åŠ ã—ã¦ `play` é–¢æ•°ã‚’å®šç¾©ã—ã¾ã™ã€‚

```ts:src/components/TaskList.stories.ts
import { userEvent, within, waitFor } from '@storybook/testing-library';
import { expect } from '@storybook/jest';

// çœç•¥...

export const InputFilled = Template.bind({});
InputFilled.play = async ({ canvasElement }) => {
  const canvas = within(canvasElement);

  await userEvent.type(canvas.getByLabelText("ã‚¿ã‚¹ã‚¯å"), "ç‰›ä¹³ã‚’è²·ã†");
  await userEvent.click(canvas.getByRole('button', { name: 'è¿½åŠ ' }));

  await waitFor(() => {
    const items = canvas.getAllByRole('listitem');
    expect(items.length).toBe(1);
  })
}
```

`play` é–¢æ•°ã¯ `StoryContext` ã¨ã„ã†å‹ã®å¼•æ•°ã‚’å—ã‘å–ã‚Šåˆ†å‰²ä»£å…¥ã§ `canvasElement` ã‚’å–å¾—ã—ã¦ã„ã¾ã™ã€‚ã“ã® `canvasElement` ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ«ãƒ¼ãƒˆã‹ã‚‰å®Ÿè¡Œã‚’é–‹å§‹ã™ã‚‹ã‚ˆã†ã«ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã‚’èª¿æ•´ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚`@storybook/testing-library` ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ãŸ `screen` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”¨ã„ã‚‹ã¨ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã®è¦ç´ ã‹ã‚‰è¦ç´ ã‚’å–å¾—ã—ã¾ã™ã€‚

å‰è¿°ã® `canvas` ã‹ã‚‰å¯¾è±¡ã®è¦ç´ ã‚’å–å¾—ã—ã¦ `@storybook/testing-library` ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ãŸ `useEvent` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆ©ç”¨ã—ã¦å…¥åŠ›ã‚„ã‚¯ãƒªãƒƒã‚¯ãªã©ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç”Ÿã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚è¦ç´ ã®å–å¾—æ–¹æ³•ã¯ [testing-library](https://testing-library.com/docs/react-testing-library/cheatsheet/#queries) ã® Query ã¨ã»ã¼åŒã˜ã§ã™ã®ã§æ™®æ®µãƒ†ã‚¹ãƒˆã‚’è¨˜è¿°ã—ã¦ã„ã‚‹ã¨ãã¨å¤‰ã‚ã‚‰ãªã„æ„Ÿã˜ã§ `play` é–¢æ•°ã‚’è¨˜è¿°ã§ãã¾ã™ã€‚

ã•ã‚‰ã« `@storybook/jest` ã® `expect` é–¢æ•°ã‚’ç”¨ã„ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ `jest` ã•ãªãŒã‚‰ãƒ†ã‚¹ãƒˆã‚’è¨˜è¿°ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

`play` é–¢æ•°ã¯ Story ãŒãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚ŒãŸå¾Œã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚å®Ÿéš›ã« Story ã‚’ç¢ºèªã™ã‚‹ã¨ input è¦ç´ ã« `play` é–¢æ•°ã§ã‚¿ã‚¤ãƒ—ã—ãŸã€Œç‰›ä¹³ã‚’è²·ã†ã€ã¨ã„ã†å€¤ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã™ã€‚

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2022-01-23 10.20.38](//images.ctfassets.net/in6v9lxmm5c8/7EP6kIz2DBLU0tc130bHBv/5398dcbe173deed7e988a69dec9129a0/____________________________2022-01-23_10.20.38.png)

Interactions ã‚¿ãƒ–ã‚’ç¢ºèªã—ã¦ã¿ã‚‹ã¨ `<li>` è¦ç´ ãŒå­˜åœ¨ã—ãªã„ãŸã‚ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚ã“ã®ã‚ˆã†ã« Storybook ã‚’é€šã˜ã¦ã‚¤ãƒ™ãƒ³ãƒˆãŒå£Šã‚Œã¦ã„ãªã„ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ãŒæˆåŠŸã™ã‚‹ã‚ˆã†ã«å®Ÿè£…ã‚’ä¿®æ­£ã—ã¾ã—ã‚‡ã†ã€‚

```vue:src/components/TaskList.vue
<script setup lang="ts">
import { ref } from 'vue'
const taskName = ref("");
const taskList = ref<string[]>([]);

const onSubmit = () => {
  taskList.value.push(taskName.value);
  taskName.value = "";
}
</script>

<template>
  <form @submit.prevent=onSubmit"">
    <div class="form-group">
      <label for="task-name">ã‚¿ã‚¹ã‚¯å</label>
      <input type="text" id="task-name" v-model="taskName" />
      <button type="submit">è¿½åŠ </button>
      <ul>
        <li v-for="task in taskList">{{ task }}</li>
      </ul>
    </div>
  </form>
</template>
```

å…¨ã¦ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ãŒæˆåŠŸã—ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2022-01-23 10.31.08 1](//images.ctfassets.net/in6v9lxmm5c8/6X0hVTrJDzADRQWa8qqEXv/99eae49fb6a34ca688a9b292536f0ae3/____________________________2022-01-23_10.31.08_1.png)

## ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ãƒãƒƒã‚°ã™ã‚‹

Storybook ä¸Šã§ UI ã®çŠ¶æ…‹ã‚’å·»ãæˆ»ã—ã¦ãƒ‡ãƒãƒƒã‚°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®æ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã«ã¯ `.storybook/main.js` ã«ãŠã„ã¦ `features.interactionsDebugger` ã‚’ `true` ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```js:.storybook/main.js
module.exports = {
  // ..
  features: {
    interactionsDebugger: true,
  },
};
```

Storybook ã‚’å†èµ·å‹•ã™ã‚‹ã¨ Interactions ã‚¿ãƒ–ã«ãƒ‡ãƒãƒƒã‚°ãƒãƒ¼ãŒè¿½åŠ ã•ã‚Œã„ã¾ã™ã€‚

![interactions-dbug](//images.ctfassets.net/in6v9lxmm5c8/2OdDcXSlylnRXL9qF3Kcu0/7bc7d8550ee76aa33e9901b3a7d46a24/interactions-dbug.gif)

## Jest ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

Storybook ä¸Šã§ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç¢ºèªã™ã‚‹ã®ã¯äººé–“ã«ã‚ˆã‚‹ç›®è¦–ã«ã‚ˆã‚‹ã‚‚ã®ã§ã™ã®ã§ Jest ã¨çµ„ã¿åˆã‚ã›ã¦è‡ªå‹•ã§ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒ†ã‚¹ãƒˆã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ã¾ãšã¯ `Jest` ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```sh
npm -D install jest @types/jest ts-jest vue-jest@next @testing-library/vue@next @testing-library/jest-dom @storybook/testing-vue3
```

[@storybook/testing-vue3](https://storybook.js.org/addons/@storybook/testing-vue3) ã¯ Storybook ã§å®šç¾©ã—ãŸ story ã‚’ãƒ†ã‚¹ãƒˆã«ãŠã„ã¦å†åˆ©ç”¨ã™ã‚‹ãŸã‚ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã™ã€‚

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå®Œäº†ã—ãŸã‚‰è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

```js:jest.config.cjs
module.exports = {
  moduleFileExtensions: ["js", "ts", "json", "vue"],
  transform: {
    "^.+\\.ts$": "ts-jest",
    "^.+\\.vue$": "vue-jest",
  },
  moduleNameMapper: {
    "^@/(.*)$": "<rootDir>/src/$1",
  },
};
```

```json:tsconfig.json
{
  "compilerOptions": {
    // ..
    "types": ["@types/jest"],
  },
}
```

ã•ã‚‰ã« Storybook ã§ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã«ã¯ Jest å®Ÿè¡Œæ™‚ã«ãŠã„ã¦ã‚‚é©ç”¨ã•ã›ã‚‹ãŸã‚ã«ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—ã¾ã™ã€‚

```js:setupFile.ts
import { setGlobalConfig } from '@storybook/testing-vue3';
import * as globalStorybookConfig from './.storybook/preview'; 

setGlobalConfig(globalStorybookConfig);
```

`jest` ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œæ™‚ã«ä½œæˆã—ãŸ `setupFile.js` ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦æŒ‡å®šã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```json:pakcage.json
"scripts": {
  "test": "jest --setupFilesAfterEnv ./setupFile.ts"
}
```

## ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ

ãã‚Œã§ã¯ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚é€šå¸¸ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆã‚’æ›¸ãæ™‚ã¨ç•°ãªã‚Šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç›´æ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã®ã§ã¯ãªãã€ä½œæˆã—ãŸ Storybook ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ Story ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ `composeStories` é–¢æ•°ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ä½œæˆã—ãŸ Story ã‚’ Jest ã§å†åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

å¯¾è±¡ã® Story ã® `play` é–¢æ•°ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒ Jest ã§æ”¹ã‚ã¦ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨˜è¿°ã›ãšã¨ã‚‚å®Ÿè¡Œã—ã¦ãã‚Œã¾ã™ã€‚

```ts:src/components/TaskList.spec.ts
import { render } from '@testing-library/vue';
import { composeStories } from '@storybook/testing-vue3';
import * as Stories from './TaskList.stories'; 

const { InputFilled, Default } = composeStories(Stories)

test('ã‚¿ã‚¹ã‚¯ãŒå­˜åœ¨ã—ãªã„ã¨ããƒªã‚¹ãƒˆã¯è¡¨ç¤ºã•ã‚Œãªã„', () => {
  const { queryAllByRole } = render(Default())
  expect(queryAllByRole('listitem').length).toBe(0)
})

test('ã‚¿ã‚¹ã‚¯åã‚’å…¥åŠ›ã—ã¦è¿½åŠ ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ãƒªã‚¹ãƒˆã«è¿½åŠ ã•ã‚Œã‚‹', async () => {
  const { container } = render(InputFilled());
  await Stories.InputFilled.play?.({ canvasElement: container } as any);
});
```

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã€å…¨ã¦ã®ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã—ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚

```sh
npm run test

> my-vue-app@0.0.0 test
> jest --setupFilesAfterEnv ./setupFile.ts

 PASS  src/components/TaskList.spec.ts
  âœ“ ã‚¿ã‚¹ã‚¯ãŒå­˜åœ¨ã—ãªã„ã¨ããƒªã‚¹ãƒˆã¯è¡¨ç¤ºã•ã‚Œãªã„ (55 ms)
  âœ“ ã‚¿ã‚¹ã‚¯åã‚’å…¥åŠ›ã—ã¦è¿½åŠ ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ãƒªã‚¹ãƒˆã«è¿½åŠ ã•ã‚Œã‚‹ (109 ms)

Test Suites: 1 passed, 1 total
Tests:       2 passed, 2 total
Snapshots:   0 total
Time:        3.637 s, estimated 10 s
Ran all test suites.
```

è©¦ã—ã«ãƒœã‚¿ãƒ³è¦ç´ ã‚’å‰Šé™¤ã—ã¦ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹ã“ã¨ã‚‚ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```vue diff:src/components/TaskList.vue
 <script setup lang="ts">
 import { ref } from "vue";
 const taskName = ref("");
 const taskList = ref<string[]>([]);

 const onSubmit = () => {
   taskList.value.push(taskName.value);
   taskName.value = "";
 };
 </script>

 <template>
   <form @submit.prevent="onSubmit">
     <div class="form-group">
       <label for="task-name">ã‚¿ã‚¹ã‚¯å</label>
       <input type="text" id="task-name" v-model="taskName" />
-       <button type="submit">è¿½åŠ </button>
       <ul>
         <li v-for="task in taskList">{{ task }}</li>
       </ul>
     </div>
   </form>
 </template>
```

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã¨æƒ³å®šé€šã‚Šã«ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¾ã™ã€‚

```sh
npm run test

> my-vue-app@0.0.0 test
> jest --setupFilesAfterEnv ./setupFile.ts

 FAIL  src/components/TaskList.spec.ts
  âœ“ ã‚¿ã‚¹ã‚¯ãŒå­˜åœ¨ã—ãªã„ã¨ããƒªã‚¹ãƒˆã¯è¡¨ç¤ºã•ã‚Œãªã„ (92 ms)
  âœ• ã‚¿ã‚¹ã‚¯åã‚’å…¥åŠ›ã—ã¦è¿½åŠ ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ãƒªã‚¹ãƒˆã«è¿½åŠ ã•ã‚Œã‚‹ (166 ms)

  â— ã‚¿ã‚¹ã‚¯åã‚’å…¥åŠ›ã—ã¦è¿½åŠ ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ãƒªã‚¹ãƒˆã«è¿½åŠ ã•ã‚Œã‚‹

    TestingLibraryElementError: Unable to find an accessible element with the role "button" and name "è¿½åŠ "

    Here are the accessible roles:

      textbox:

      Name "ã‚¿ã‚¹ã‚¯å":
      <input
        id="task-name"
        type="text"
      />

      --------------------------------------------------
      list:

      Name "":
      <ul />

      --------------------------------------------------

    Ignored nodes: comments, <script />, <style />
    <div>
      <form>
        <div
          class="form-group"
        >
          <label
            for="task-name"
          >
            ã‚¿ã‚¹ã‚¯å
          </label>
          <input
            id="task-name"
            type="text"
          />
          <ul>

          </ul>
        </div>
      </form>
    </div>

      26 |
      27 |   await userEvent.type(canvas.getByLabelText("ã‚¿ã‚¹ã‚¯å"), "ç‰›ä¹³ã‚’è²·ã†");
    > 28 |   await userEvent.click(canvas.getByRole('button', { name: 'è¿½åŠ ' }));
         |                                ^
      29 |
      30 |   await waitFor(() => {
      31 |     const items = canvas.getAllByRole('listitem');

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:38:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:90:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:62:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:111:19
      at Function.Object.<anonymous>.exports.InputFilled.play (src/components/TaskList.stories.ts:28:32)
      at Object.<anonymous> (src/components/TaskList.spec.ts:14:3)

Test Suites: 1 failed, 1 total
Tests:       1 failed, 1 passed, 2 total
Snapshots:   0 total
Time:        6.032 s
Ran all test suites.
```

## æ„Ÿæƒ³

Storybook ä¸Šã§ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒ†ã‚¹ãƒˆã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã“ã¨ã§æ›´ã«æ´»ç”¨ã®å¹…ã‚’åºƒã’ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚å®Ÿéš›ã«æç”»å†…å®¹ã‚’ç›®è¦–ã—ãªãŒã‚‰ãƒ†ã‚¹ãƒˆã‚’ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã®ã§ testing-library ã§ãƒ†ã‚¹ãƒˆã‚’è¨˜è¿°ã™ã‚‹ã®ã¨æ¯”ã¹ã¦ã‚ˆã‚Šå–ã‚Šçµ„ã¿ã‚„ã™ããªã£ã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚

Story ã‚’å†åˆ©ç”¨å¯èƒ½ãªã¨ã“ã‚ã‚‚å¬‰ã—ã„ç‚¹ã§ã™ã­ã€‚

ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã‹ã‚‰ç¢ºèªã§ãã¾ã™ã€‚

https://github.com/azukiazusa1/vue-storybook-interaction-tests-sample

## å‚è€ƒ

https://storybook.js.org/docs/vue/writing-stories/play-function
https://storybook.js.org/docs/vue/writing-tests/interaction-testing
https://zenn.dev/takepepe/articles/storybook-driven-development
https://qiita.com/dia/items/3b984afec9a51cc803d1
