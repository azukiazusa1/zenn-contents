---
title: "Webpack5 Module Federation ã§å§‹ã‚ã‚‹ãƒã‚¤ã‚¯ãƒ­ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰"
emoji: "ğŸ¥"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['microfrontend', 'javascript', 'react', 'vue']
published: true
---

## Module Federation ã¨ã¯

Module Federation ã¯ Webpack 5 ã‹ã‚‰ã‚³ã‚¢æ©Ÿèƒ½ã¨ã—ã¦å°å…¥ã•ã‚Œã¾ã—ãŸã€‚

https://webpack.js.org/concepts/module-federation/

Module Federation ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ç•°ãªã‚‹ JavaScript ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰å‹•çš„ã«ã‚³ãƒ¼ãƒ‰ã‚’ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã¯è¤‡æ•°ã®å€‹åˆ¥ã®ãƒ“ãƒ«ãƒ‰ã«ã‚ˆã£ã¦å˜ä¸€ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã™ã‚‹æ‰‹æ®µã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã€‚

ã“ã‚Œã¯**ãƒã‚¤ã‚¯ãƒ­ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**ã¨ã„ã†è¨€è‘‰ã§ã‚ˆãçŸ¥ã‚‰ã‚Œã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ãŒ Module Federation ã®ç›®çš„ã¨ã—ã¦ã¯ãã‚Œã«é™å®šã•ã‚Œã¾ã›ã‚“ã€‚

## ãƒã‚¤ã‚¯ãƒ­ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ã¯ï¼Ÿ

ãƒã‚¤ã‚¯ãƒ­ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«ã¤ã„ã¦ã†ã¾ãèª¬æ˜ã§ãã‚‹è‡ªä¿¡ã¯ãªã„ã®ã§èª¬æ˜ã¯å§”ã­ã¾ã™ã€‚

https://micro-frontends.org/

## ãƒã‚¤ã‚¯ãƒ­ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã™ã‚‹

ãã‚Œã§ã¯ã€å®Ÿéš›ã« Module Federation ã‚’ä½¿ã£ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
ä¾‹ã¨ã—ã¦ã€ä»¥ä¸‹ã®3ã¤ã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒãƒ¼ãƒ ãŒå­˜åœ¨ã™ã‚‹ã¨ä»®å®šã—ã¾ã—ã‚‡ã†ã€‚

- ãƒ˜ãƒƒãƒ€ãƒ¼ãƒãƒ¼ãƒ ï¼šãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ†ã‚’ä½œæˆã™ã‚‹ãƒãƒ¼ãƒ ã€‚React
- ãƒ•ãƒƒã‚¿ãƒ¼ãƒãƒ¼ãƒ ï¼šãƒ•ãƒƒã‚¿ãƒ¼éƒ¨åˆ†ã‚’ä½œæˆã™ã‚‹ãƒãƒ¼ãƒ ã€‚Vue.js
- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒãƒ¼ãƒ ï¼šãƒ˜ãƒƒãƒ€ãƒ¼ãƒãƒ¼ãƒ ã¨ãƒ•ãƒƒã‚¿ãƒ¼ãƒãƒ¼ãƒ ã®ä½œæˆã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ä½œæˆã™ã‚‹ãƒãƒ¼ãƒ ã€‚React

### ãƒ˜ãƒƒãƒ€ãƒ¼ãƒãƒ¼ãƒ ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ

ã¾ãšã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ†ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚
åˆã‚ã¯ã„ã¤ã‚‚ã¨åŒã˜ã‚ˆã†ã« React ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¾ã™ã€‚

```sh
npm create-react-app header-app
```

æ¬¡ã« `Header` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¦ `App.js` ã§èª­ã¿è¾¼ã‚“ã§è¡¨ç¤ºã•ã›ã¦ã¿ã¾ã™ã€‚ã“ã“ã‚‚é€šå¸¸ã®æµã‚Œã¨ã‹ã‚ã‚Šã‚ã‚Šã¾ã›ã‚“ã€‚

```js:header-app/src/components/Header.js
const Header = () => {
  return (
    <header
      style={{
        backgroundColor: "deepskyblue",
        color: "white",
        margin: 0,
        padding: "4px",
      }}
    >
      <h1>This is excellent header!</h1>
    </header>
  );
};

export default Header;

```

```js:header-app/src/App.js
import "./App.css";
import Header from "./components/Header";

function App() {
  return (
    <div className="App">
      <Header />
    </div>
  );
}

export default App;
```

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•ã—ã¾ã™ã€‚ãƒ˜ãƒƒãƒ€ãƒ¼ãƒãƒ¼ãƒ ã®ä½œæˆã—ãŸç´ æ™´ã‚‰ã—ã„ãƒ˜ãƒƒãƒ€ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚

```sh
cd header-app
yarn start
```

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2021-11-21 21.03.58](//images.contentful.com/in6v9lxmm5c8/3bnxOQ53E7HpTqs3v8EkZy/7b675f8547f571357c5d9ee43b92c421/____________________________2021-11-21_21.03.58.png)

### Module Federation ã®è¨­å®š

ã“ã“ã¾ã§ã¯é€šå¸¸é€šã‚Šã® React ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½œæˆã§ã‚ã‚Šã€ã‚ã¾ã‚Šé¢ç™½ã¿ã®ãªã„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚ã“ã“ã§ã¯ä½œæˆã—ãŸãƒ˜ãƒƒãƒ€ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç•°ãªã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã« Wepback ã®è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚

åˆã‚ã« `create-react-app` ã§ä½œæˆã—ãŸ wepback ã®è¨­å®šã‚’ä¸Šæ›¸ãå¿…è¦ãŒã‚ã‚‹ã®ã§ãã®ä½œæ¥­ã‚’è¡Œã„ã¾ã™ã€‚

```sh
yarn add -D webpack webpack-cli webpack-dev-server html-webpack-plugin serve
yarn add -D babel-loader @babel/core @babel/preset-env @babel/preset-react
yarn add -D css-loader style-loader @svgr/webpack style-loader url-loader
```

`webpack.config.js` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†

```js:header-app/webpack.config.js
const path = require("path");
const HtmlWebpackPlugin = require("html-webpack-plugin");

const PORT = 3001;

module.exports = {
  entry: path.resolve(__dirname, "./src/index.js"),
  devServer: {
    port: PORT,
  },
  output: {
    publicPath: "auto",
  },
  resolve: {
    extensions: [".js", ".jsx"],
  },
  module: {
    rules: [
      {
        test: /\.css$/i,
        use: ["style-loader", "css-loader"],
      },
      {
        test: /\.svg$/,
        use: ['@svgr/webpack', 'url-loader'],
      },
      {
        test: /\.(js|jsx)$/,
        exclude: /node_modules/,
        use: ["babel-loader"],
      },
    ],
  },
  plugins: [
    new HtmlWebpackPlugin({
      manifest: "./public/manifest.json",
      favicon: "./public/favicon.ico",
      template: "./public/index.html",
    }),
  ],
};
```

ç¶šã„ã¦ Module Federation ã®è¨­å®šã‚’è¨˜è¿°ã—ã¦ã„ãã¾ã™ã€‚å¼•ãç¶šã `webpack.config.js` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¾ã™ã€‚

```js:header-app/webpack.config.js
const HtmlWebpackPlugin = require("html-webpack-plugin");
const ModuleFederationPlugin = require("webpack/lib/container/ModuleFederationPlugin");

module.exports = {
  // other webpack configs...
  plugins: [
    new ModuleFederationPlugin({
      name: "header_app",
      filename: "remoteEntry.js",
      exposes: {
        "./Header": "./src/components/Header.js",
      },
    }),
  ]
}
```

Module Federation ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ `ModuleFederationPlugin` ã¨ã„ã†ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã«ãªã‚‹ã®ã§ã€åˆã‚ã«ã“ã‚Œã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚

```js
const ModuleFederationPlugin = require("webpack/lib/container/ModuleFederationPlugin");
```

`plugins` ã®é…åˆ—ã« `new ModuleFederationPlugin({})` ã‚’è¿½åŠ ã—ã¦ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã—ã¦è¿½åŠ ã—ã¾ã™ã€‚`ModuleFederationPlugin` ã®å„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æ¬¡ã®ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚

- `name`
  - exporse ã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®åå‰ã€‚ä¾‹ãˆã° `header_app` ã¨ã„ã†åå‰ã§ expose ã™ã‚‹ã¨åˆ¥ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ã§æŒ‡å®šã™ã‚‹ã¨ã `header_app@${URL}` ã®ã‚ˆã†ãªåå‰ã‚’ä½¿ã†ã“ã¨ã«ãªã‚‹ã€‚`exposes` ã‚’æŒ‡å®šã™ã‚‹ã¨ãã«ã¯å¿…é ˆã«ãªã‚‹ã€‚
- `filename`
  - å‡ºåŠ›ã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«å
- `exposes`
  - ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦å…¬é–‹ã—ãŸã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå½¢å¼ã§æŒ‡å®šã™ã‚‹ã€‚ã‚­ãƒ¼ãŒå…¬é–‹ã•ã‚Œã‚‹éš›ã«ä½¿ã‚ã‚Œã‚‹ãƒ‘ã‚¹åã§ã€å€¤ãŒã“ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ã®ç›¸å¯¾ãƒ‘ã‚¹ã€‚

æ¬¡ã« `babel.config.json` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

```json:header-app/babel.config.json
{
  "presets": ["@babel/preset-env", ["@babel/preset-react", {
     "runtime": "automatic"
  }]]
}
```

æœ€å¾Œã« `package.json` ã® `scripts` ã‚’ `webpack` ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã—ã‚‡ã†ã€‚

```json:header-app/package.json
  "scripts": {
    "start": "webpack serve --open --mode development",
    "build": "webpack --mode production"
  },
```

ã“ã“ã¾ã§å®Œäº†ã—ãŸã‚‰ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†èµ·å‹•ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```js
yarn start
```

ã†ã¾ãè¨­å®šã®ä¿®æ­£ãŒå®Œäº†ã—ã¦ã„ãŸã‚‰å¤‰ã‚ã‚‰ãšãƒ˜ãƒƒãƒ€ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™ã€‚
ã“ã“ã§ http://localhost:3001/remoteEntry.js ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã¦ãã ã•ã„ã€‚ Module Federation ã®è¨­å®šãŒã†ã¾ãã§ãã¦ã„ãŸå ´åˆã¯ã€æ¬¡ã®ã‚ˆã†ã«ãƒ•ã‚¡ã‚¤ãƒ«ãŒå‡ºåŠ›ã•ã‚Œã¦ã„ã¾ã™ã€‚

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2021-11-21 22.13.53](//images.contentful.com/in6v9lxmm5c8/SMvnS3pgPoptWvaytfruH/a336bb35c365349df3732d9b97f98e86/____________________________2021-11-21_22.13.53.png)

## ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒãƒ¼ãƒ 

ç¶šã„ã¦ã€ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒãƒ¼ãƒ ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚ãƒ˜ãƒƒãƒ€ãƒ¼ãƒãƒ¼ãƒ ãŒ expose ã—ãŸãƒ˜ãƒƒãƒ€ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã«å–ã‚Šè¾¼ã¿ã¾ã™ã€‚

ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ãŸã¨ãã¨åŒã˜ã `create-react-app` ã§ React ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¦ webpack ã®è¨­å®šã‚’ä¸Šæ›¸ãã—ã¾ã—ã‚‡ã†ã€‚

```sh
npx create-react-app main-contents
```

```sh
yarn add -D webpack webpack-cli webpack-dev-server html-webpack-plugin serve
yarn add -D babel-loader @babel/core @babel/preset-env @babel/preset-react
yarn add -D css-loader style-loader @svgr/webpack style-loader url-loader
```

```js:main-contents/webpack.config.js
const path = require("path");
const HtmlWebpackPlugin = require("html-webpack-plugin");

const PORT = 3000; // ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã¯ port ç•ªå·ã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚‹

module.exports = {
  entry: path.resolve(__dirname, "./src/index.js"),
  devServer: {
    port: PORT,
  },
  output: {
    publicPath: "auto",
  },
  resolve: {
    extensions: [".js", ".jsx"],
  },
  module: {
    rules: [
      {
        test: /\.css$/i,
        use: ["style-loader", "css-loader"],
      },
      {
        test: /\.svg$/,
        use: ['@svgr/webpack', 'url-loader'],
      },
      {
        test: /\.(js|jsx)$/,
        exclude: /node_modules/,
        use: ["babel-loader"],
      },
    ],
  },
  plugins: [
    new HtmlWebpackPlugin({
      manifest: "./public/manifest.json",
      favicon: "./public/favicon.ico",
      template: "./public/index.html",
    }),
  ],
};
```

```json:main-contents/babel.config.json
{
  "presets": ["@babel/preset-env", ["@babel/preset-react", {
     "runtime": "automatic"
  }]]
}
```

```json:main-contents/package.json
  "scripts": {
    "start": "webpack serve --open --mode development",
    "build": "webpack --mode production"
  },
```

æ¬¡ã« `webpack.config.js` ã« Module Federation ã®è¨­å®šã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ã€‚

```js:main-contents/webpack.config.js
const ModuleFederationPlugin = require("webpack/lib/container/ModuleFederationPlugin");

module.exports = {
  // other webpack configs...
  plugins: [
    new ModuleFederationPlugin({
      name: "main_contents",
      filename: "remoteEntry.js",
      remotes: {
        header_app: "header_app@http://localhost:3001/remoteEntry.js",
      }
    }),
  ]
}
```

ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ™‚ã¨ã¯è¨­å®šã«å¤‰æ›´ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å…¬é–‹ã—ãªã„ã®ã§ `expose` ã®è¨­å®šã¯è¨˜è¼‰ã—ã¦ãŠã‚Šã¾ã›ã‚“ã€‚ãã®ä»£ã‚ã‚Šã«ç•°ãªã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ã‚‚ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã« `remotes` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚

`remote` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå½¢å¼ã§æŒ‡å®šã—ã€å–ã‚Šè¾¼ã¿ãŸã„åå‰ã‚’ã‚­ãƒ¼ã¨ã— Module Federation ã«ã‚ˆã£ã¦å‡ºåŠ›ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’å€¤ã«è¨­å®šã—ã¾ã™ã€‚

ã‚‚ã†ä¸€ã¤å¤‰æ›´ã™ã‚‹ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚`src/index.js` ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’ãã®ã¾ã¾`src/bootstrap.js` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ãƒšãƒ¼ã‚¹ãƒˆã—ã¾ã™ã€‚

```js:main-contents/src/bootstrap.js
import React from "react";
import ReactDOM from "react-dom";
import "./index.css";
import App from "./App";
import reportWebVitals from "./reportWebVitals";

ReactDOM.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
  document.getElementById("root")
);

// If you want to start measuring performance in your app, pass a function
// to log results (for example: reportWebVitals(console.log))
// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals
reportWebVitals();
```

`src/index.js` ãƒ•ã‚¡ã‚¤ãƒ«ã¯ `src/bootstrap.js` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ import ã™ã‚‹ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ã€‚

```js:main-contents/src/index.js
import('./bootstrap.js')
```

ã“ã‚Œã¯ `bootstrap.js` ãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†ã‚’éåŒæœŸå®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã§ã™ã€‚Webpack ãŒ `header_app` ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ•ã‚§ãƒƒãƒã—ã¦ãã‚‹ã¾ã§å¾…ã¤å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã®è¨­å®šã«ã‚ˆã£ã¦ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ãƒ˜ãƒƒãƒ€ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ import ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚`App.js` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¾ã—ã‚‡ã†ã€‚

```js:main-contents/src/App.js
import Header from "header_app/Header";

function App() {
  return (
    <div className="App">
      <Header />
      <main>
        <h1>Main contents</h1>
      </main>
    </div>
  );
}

export default App;
```

**ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•ã—ãŸã¾ã¾**ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•ã—ã¦ãã ã•ã„ã€‚

```sh
cd main_contents
yarn start
```

http://localhost:3000 ã‚’è¦‹ã¦ãã ã•ã„ï¼ãƒ˜ãƒƒãƒ€ãƒ¼ãƒãƒ¼ãƒ ãŒä½œæˆã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã—ã£ã‹ã‚Šã¨è¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ï¼ï¼

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2021-11-21 23.58.44](//images.contentful.com/in6v9lxmm5c8/3qbZibLRtRpePaPoguvWP1/b0796b87684a439db44edbf72b3e4964/____________________________2021-11-21_23.58.44.png)

ã•ã‚‰ã«ã€ãƒ˜ãƒƒãƒ€ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç·¨é›†ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```diff js:header-app/src/components/Header.js
 const Header = () => {
   return (
     <header
       style={{
-        backgroundColor: "deepskyblue", 
+        backgroundColor: "aquamarine",
         color: "white",
         margin: 0,
         padding: "4px",
       }}
     >
       <h1>This is excellent header!</h1>
     </header>
   );
 };

 export default Header;
```

ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å´ã§ã¯ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ã¯åŠ¹ã‹ãªã„ã®ã§ãƒ–ãƒ©ã‚¦ã‚¶ã‚’æ›´æ–°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚å…ˆç¨‹ãƒ˜ãƒƒãƒ€ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§è¡Œã£ãŸå¤‰æ›´ãŒåæ˜ ã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™ï¼

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2021-11-22 0.03.53](//images.contentful.com/in6v9lxmm5c8/3EgG63QFn0PZXgtRCGiqM9/ef31be6c7708bd9a48cc49c67a18afb0/____________________________2021-11-22_0.03.53.png)

## ä¾å­˜é–¢ä¿‚ã®å…±æœ‰

ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯äº’ã„ã« React ã«ä¾å­˜ã—ã¦ã„ã¾ã™ãŒã€ã©ã¡ã‚‰ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚‚ React ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿è¾¼ã‚“ã§ã—ã¾ã†ã®ã§çµæœçš„ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãããªã£ã¦ã—ã¾ã„ã¾ã™ã€‚

`shared` ã¨ã„ã†ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ä¾å­˜é–¢ä¿‚ã‚’å…±æœ‰ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã™ã‚‹ã¨ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¾å­˜é–¢ä¿‚ã‚’å„ªå…ˆçš„ã«å‚ç…§ã—ã¾ã™ã€‚ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä¾å­˜é–¢ä¿‚ãŒå­˜åœ¨ã—ãªã„å ´åˆã«ã¯ã€ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒç‹¬è‡ªã«ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’è¡Œã„ã¾ã™ã€‚

ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã©ã¡ã‚‰ã«ã‚‚ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```js:webpack.config.js
const deps = require("./package.json").dependencies;

module.exports = {
  plugins: [
    new ModuleFederationPlugin({
      shared: {
        react: {
          requiredVersion: deps.react,
          singleton: true
        },
        "react-dom": {
          requiredVersion: deps["react-dom"],
          singleton: true
        },
      },
    }),
  ],
};
```

`shared` ã¯é…åˆ—å½¢å¼ã¾ãŸã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå½¢å¼ã§æŒ‡å®šã—ã¾ã™ã€‚ã‚­ãƒ¼ã«ã¯ `package.json` ã® `dependencies` ã¾ãŸã¯ `devDependencies` ã«æŒ‡å®šã—ã¦ã„ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªåã‚’è¨˜è¿°ã—ã¾ã™ã€‚
å€¤ã«ã¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã§ãã¾ã™ã€‚

- `requiredVersion`
  - å®Ÿéš›ã«ä¾å­˜ã—ã¦ã„ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¨˜è¼‰ã—ã¦ã„ã¾ã™ã€‚
- `singleton`
  - `true` ã«ã™ã‚‹ã¨1ã¤ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ã¿ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚·ã‚§ã‚¢ã™ã‚‹ã‚ˆã†ã«å¼·åˆ¶ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä¾‹ã¨ã—ã¦ã¯ `react` ã‚„ `react-dom` ãªã©ã®ã‚°ãƒ«ãƒ¼ãƒãƒ«ãªå†…éƒ¨çŠ¶æ…‹ã‚’æŒã¤ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹ã¹ãã§ã™ã€‚

ã¾ãŸ `shared` ã‚’è¨­å®šã—ãŸå ´åˆãƒ˜ãƒƒãƒ€ãƒ¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚‚ `bootstrap.js` ã‚’ä½œæˆã—ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒéåŒæœŸã«é–‹å§‹ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```js:header-app/src/index.js
import('./bootstrap')
```

## ãƒ•ãƒƒã‚¿ãƒ¼ãƒãƒ¼ãƒ ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ

æœ€å¾Œã«ãƒ•ãƒƒã‚¿ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¦ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰å‘¼ã³å‡ºã™ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚
ãƒ•ãƒƒã‚¿ãƒ¼ãƒãƒ¼ãƒ ã¯é•·å¹´ Vue.js ã®çµŒé¨“ãŒã‚ã‚‹ã®ã§ Vue.js ã‚’ä½¿ç”¨ã—ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã™ã‚‹ã“ã¨ã«æ±ºã‚ã¾ã—ãŸã€‚

ä»Šå›ã¯ Webpack ã®è¨­å®šã‚’æ¥½ã«è¡Œã†ãŸã‚ã« [create-mf-app](https://github.com/jherr/create-mf-app) ã‚’ä½¿ç”¨ã—ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¾ã™ã€‚

```sh
npx create-mf-app
? Pick the name of your app: (host) footer-app # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åå‰
? Project Type: (Use arrow keys) # Application ã‚’é¸æŠ
â¯ Application 
  API Server 
  Library 
? Port number: (8080) # ãƒãƒ¼ãƒˆç•ªå·ã¯ãã®ã¾ã¾
? Framework: # ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯ vue3 ã‚’é¸æŠ
  svelte 
  vanilla 
  vue2 
â¯ vue3 
  inferno 
  lit-html 
  mithril 
? Language: (Use arrow keys) # è¨€èªã¯ javascript
  typescript 
â¯ javascript 
? CSS: (Use arrow keys) # æ™®é€šã® CSS ã‚’é¸æŠ
â¯ CSS 
  Tailwind 
```

ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ãŸã‚‰é€šå¸¸é€šã‚Š Vue.js ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚å°‘ã—é•ã†ã®ã¯å¾Œã»ã© Vue.js ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ Web Components ã«å¤‰æ›ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ãƒ•ã‚¡ã‚¤ãƒ«åã®æœ€å¾Œã‚’ `.ce.vue` ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```vue:footer-app/src/components/TheFooter.ce.vue
<script setup>
defineProps({
  title: {
    type: String,
    default: "The Footer",
  },
});
</script>

<template>
  <footer class="footer">
    <h1>{{ title }}</h1>
    <p>This is awesome footer</p>
  </footer>
</template>

<style scoped>
.footer {
  background-color: #424242;
  color: white;
  padding: 4px;
}
</style>
```

Vue.js ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ React ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ãã®ã¾ã¾ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ããªã„ã®ã§ Web Components ã«å¤‰æ›ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚åŒãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã« `TheFooter.js` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

```js:footer-app/src/components/TheFooter.js
import { defineCustomElement } from "vue";
import TheFooter from "./TheFooter.ce.vue";

const TheFooterElement = defineCustomElement(TheFooter);

customElements.define("the-footer", TheFooterElement);
```

Vue.js ã® `defineCustomElement` ã‚’å‘¼ã³å‡ºã›ã° Vue.js ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ Web Components ã«å¤‰æ›ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ Web Components ã«å¤‰æ›ã—ãŸè¦ç´ ã‚’ `customElements.define` ã§ç™»éŒ²ã—ã¦ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚Vue.js ã¨ Web Components ã®é–¢ä¿‚ã«ã¤ã„ã¦ã‚‚ã†å°‘ã—è©³ã—ãçŸ¥ã‚ŠãŸã„å ´åˆã«ã¯ä»¥ä¸‹ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

https://v3.ja.vuejs.org/guide/web-components.html

`webpack.config.js` ã‚’ç·¨é›†ã—ã¦ä½œæˆã—ãŸãƒ•ãƒƒã‚¿ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ expose ã—ã¾ã™ã€‚

```diff js:footer-app/webpack.config.js
   plugins: [
     new VueLoaderPlugin(),
     new ModuleFederationPlugin({
       name: "footer_app",
       filename: "remoteEntry.js",
-      exposes: {},
+      exposes: {
+        "./TheFooter": "./src/components/TheFooter.js",
+      },
       shared: require("./package.json").dependencies,
     }),
```
 
ã“ã‚Œã§æº–å‚™ã¯å®Œäº†ã—ãŸã®ã§ãƒ•ãƒƒã‚¿ãƒ¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•ã—ã¾ã—ã‚‡ã†ã€‚

```sh
cd footer-app
npm i 
npm start
```

ç¶šã„ã¦ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç·¨é›†ã—ã¦ãƒ•ãƒƒã‚¿ãƒ¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æä¾›ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

`webpack.config.js` ã‚’ç·¨é›†ã—ã¦ `footer_app` ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```diff js:main-contents/webpack.config.js
       remotes: {
         header_app: "header_app@http://localhost:3001/remoteEntry.js",
+        footer_app: "footer_app@http://localhost:8080/remoteEntry.js",
       },
```

`App.js` ã§ãƒ•ãƒƒã‚¿ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ import ã—ã¾ã—ã‚‡ã†ã€‚(ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ãŒç•°ãªã‚‹ã®ãŒå¾®å¦™ãªã®ã§ã‚‚ã†å°‘ã—å·¥å¤«ã—ãŸã»ã†ãŒè‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼‰

```diff js:main-contents/src/App.js
 import Header from "header_app/Header";
+ import "footer_app/TheFooter";
 
 function App() {
   return (
     <div className="App">
       <Header />
       <main>
         <h1>Main contents</h1>
       </main>
+      <the-footer title="micro-frontend app" />
     </div>
   );
 }
 
 export default App;
```

ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†èµ·å‹•ã—ã¦ã¿ã¦ãã ã•ã„ã€‚æœ›ã¿é€šã‚Šã€ãƒ•ãƒƒã‚¿ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™ï¼ï¼

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2021-11-22 16.05.22](//images.contentful.com/in6v9lxmm5c8/1qMkcJJemwqA14S2APWJ8w/631289d8543627e50196f432efd96067/____________________________2021-11-22_16.05.22.png)

ä»Šå›ä½œæˆã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ä»¥ä¸‹ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã‹ã‚‰ç¢ºèªã§ãã¾ã™ã€‚

https://github.com/azukiazusa1/sample-micro-frontend

## å‚è€ƒ

- https://webpack.js.org/concepts/module-federation/
- https://webpack.js.org/plugins/module-federation-plugin/
- https://medium.com/swlh/webpack-5-module-federation-a-game-changer-to-javascript-architecture-bcdd30e02669
- https://blog.hiroppy.me/entry/module-federation
- https://www.youtube.com/watch?v=lKKsjpH09dU